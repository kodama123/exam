# 株式会社フィックスポイント プログラミング試験
## 実行環境
### Python 3.8.2

## 設問
A社の監視システムでは、監視対象となる複数台のサーバに対して一定間隔でping応答確認を行っており、
確認結果は以下に示すカンマ区切りの形式で1行ずつ監視ログファイルに追記される。

＜確認日時＞,＜サーバアドレス＞,＜応答結果＞

確認日時は、YYYYMMDDhhmmssの形式。ただし、年＝YYYY（4桁の数字）、月＝MM（2桁の数字。以下同様）、日＝DD、時＝hh、分＝mm、秒＝ssである。
サーバアドレスは、ネットワークプレフィックス長付きのIPv4アドレスである。
応答結果には、pingの応答時間がミリ秒単位で記載される。ただし、タイムアウトした場合は"-"(ハイフン記号)となる。
ログはlog.txtに記述されている。

## 設問1
監視ログファイルを読み込み、故障状態のサーバアドレスとそのサーバの故障期間を出力するプログラムを作成せよ。  
出力フォーマットは任意でよい。  
なお、pingがタイムアウトした場合を故障とみなし、最初にタイムアウトしたときから、次にpingの応答が返るまでを故障期間とする。  

## test1.pyの実行結果
実行方法
```
python test1.py
```
実行結果
```
サーバーアドレス:10.20.30.1/16, 故障期間:20201019133324 - 20201021133124  
サーバーアドレス:10.20.30.2/16, 故障期間:20201020133125 - 20201021133125
サーバーアドレス:192.168.1.1/24, 故障期間:20201020133134 - 20201021133134
サーバーアドレス:192.168.1.2/24, 故障期間:20201020133135 - 20201021133135
サーバーアドレス:10.20.30.1/16, 現在も故障中
サーバーアドレス:10.20.30.2/16, 現在も故障中
サーバーアドレス:192.168.1.1/24, 現在も故障中
サーバーアドレス:192.168.1.2/24, 現在も故障中
```

流れ  
pingの情報が「-」であるときにサーバーのIPアドレス、日時の格納。  
次に同じIPのログが来た時に正常であるときにその時の日時と前回の接続切れしていた時の日時を故障期間として表示。  
この時に故障情報を格納している配列からIPアドレスの情報を削除。  
ログを読み終わったときに故障情報を格納している配列にあるIPアドレスが現在も故障しているとみなしている。  

## 設問2
ネットワークの状態によっては、一時的にpingがタイムアウトしても、一定期間するとpingの応答が復活することがあり、  
そのような場合はサーバの故障とみなさないようにしたい。  
N回以上連続してタイムアウトした場合にのみ故障とみなすように、設問1のプログラムを拡張せよ。  
Nはプログラムのパラメータとして与えられるようにすること。  

## test2.pyの実行結果
実行方法
```
python test2.py 2
```
実行結果
```
サーバーアドレス:10.20.30.1/16, 故障期間:20201019133324 - 20201020133324
サーバーアドレス:10.20.30.1/16, 故障期間:20201021133324 - 20201022133324
サーバーアドレス:10.20.30.2/16, 故障期間:20201020133125 - 20201020133325
サーバーアドレス:10.20.30.2/16, 故障期間:20201022133125 - 20201022133325
サーバーアドレス:192.168.1.1/24, 故障期間:20201020133134 - 20201020133234
サーバーアドレス:192.168.1.1/24, 故障期間:20201022133134 - 20201022133234
サーバーアドレス:192.168.1.2/24, 故障期間:20201020133135 - 20201020133235
サーバーアドレス:192.168.1.2/24, 故障期間:20201022133135 - 20201022133235
```

流れ  
現在のIPアドレスが接続切れを起こした時に、  
初めて起こした場合：接続切れを起こした日時、接続切れが終了した日時を更新  
前回に引き続き起こした場合：接続切れが終了した日時を更新  
現在は接続切れを起こしていないかつ前回は接続切れを起こしていた：各値（接続切れを起こした日時、接続切れが終了した日時、回数）を0にする。  
その後、コマンドライン引数でしていした数以上接続切れを起こしていたIPアドレスを表示  

## 設問3
サーバが返すpingの応答時間が長くなる場合、サーバが過負荷状態になっていると考えられる。  
そこで、直近m回の平均応答時間がtミリ秒を超えた場合は、サーバが過負荷状態になっているとみなそう。  
設問2のプログラムを拡張して、各サーバの過負荷状態となっている期間を出力できるようにせよ。mとtはプログラムのパラメータとして与えられるようにすること。  

## test3.pyの実行結果
実行方法
```
python test3.py --N 4 --m 2 --t 25
```
実行結果
```
サーバーアドレス:10.20.30.1/16, 故障期間:20201019133324 - 20201020133324
サーバーアドレス:10.20.30.1/16, 故障期間:20201021133324 - 20201022133324

サーバーアドレス:10.20.30.1/16, 過負荷期間:20201019133224 - 20201021133224, ping_average:262.0, ping_sum:524
```
流れ  
故障期間の表示はtest2.pyと同様
各IPアドレスの接続成功していた時の接続切れを起こした日時、接続切れが終了した日時、pingを配列に格納
直近m回のpingの平均がt以上のアドレスと期間を表示  

## 設問4
ネットワーク経路にあるスイッチに障害が発生した場合、そのスイッチの配下にあるサーバの応答がすべてタイムアウトすると想定される。
そこで、あるサブネット内のサーバが全て故障（ping応答がすべてN回以上連続でタイムアウト）している場合は、
そのサブネット（のスイッチ）の故障とみなそう。
設問2または3のプログラムを拡張して、各サブネット毎にネットワークの故障期間を出力できるようにせよ。

## test4.pyの実行結果
実行方法
```
python test4.py 4
```
実行結果
```
サーバーアドレス:10.20.30.1/16, 故障期間:20201019133324 - 20201020133324
サーバーアドレス:10.20.30.1/16, 故障期間:20201021133324 - 20201022133324
故障したスイッチは無し
```

流れ  
故障期間の表示はtest2.pyと同様。  
create_networkで現在参照しているIPアドレスと同ネットワーク範囲内にあるIPアドレスとネットマスクを取得。  
配列：networkにネットマスクをkey値として同一ネットワーク内にあるIPアドレスと故障状況を格納する。  
check_subnetで壊れたスイッチがあるかどうか確認する（同一ネットワーク内全てのIPアドレスの故障状況がFalseになっているかどうか確認）  
あれば、故障時期の表示。なければ故障無しと表示する。
